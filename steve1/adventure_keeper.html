<!doctype html>
<html>
    <head>
        <meta name="viewport" content="width=device-width", initial-scale="1.0">
        <meta charset="utf-8">
        <title>RPG Practice</title>
        <style>
            #input-title {
                width: 90%;
            }
            .input {
                width: 90%;
                field-sizing: content;
                min-height: 2rem;
            }
        </style>
    </head>

    <body>
        <a href="steve1.html"><-- Steve's Homepage</a>
        <h1>Adventure Keeper</h1>
        <select id="dd-games"></select>
        <button id="b-new">New Game</button>
        <br><br>
        <label for="input-title">Title</label>
        <br>
        <input id="input-title" type="text">
        <br><br>
        <label for="input-setting">Setting & Genre</label>
        <br>
        <textarea class="input" id="input-setting"></textarea>
        <br><br>
        <label for="input-tone">Tone (Gonzo, Slice-of-Life, Gritty, Horror, etc.)</label>
        <br>
        <textarea class="input" id="input-tone"></textarea>
        <br><br>
        <label for="input-extras">Extras (Magic, Supernatural, Superpowers, Augmentations, etc.)</label>
        <br>
        <textarea class="input" id="input-extras"></textarea>
        <br><br>
        <label for="input-scale">Scale</label>
        <br>
        <textarea class="input" id="input-scale"></textarea>
        <br><br>
        <label for="input-issues-current">Current Issues</label>
        <br>
        <textarea class="input" id="input-issues-current"></textarea>
        <br><br>
        <label for="input-issues-impending">Impending Issues</label>
        <br>
        <textarea class="input" id="input-issues-impending"></textarea>
        <br><br>
        <label for="input-faces-places">Faces & Places</label>
        <br>
        <textarea class="input" id="input-faces-places"></textarea>
        <br><br>
        <label for="input-rumors">Rumors</label>
        <br>
        <textarea class="input" id="input-rumors"></textarea>
        <br><br>
        <label for="input-inciting">Inciting Incident (Call to Adventure, Immediate Complication, etc.)</label>
        <br>
        <textarea class="input" id="input-inciting"></textarea>
        
        <br><br>
        <button id="b-save-all">Save Game</button>
        <button id="b-delete">Delete Game</button>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                let storedGames = [];
                try {
                    storedGames = JSON.parse(localStorage.getItem("games")) || [];
                } catch {
                    localStorage.removeItem("games");
                    storedGames = [];
                }
                
                const ddGames = document.getElementById("dd-games");
                const bNew = document.getElementById("b-new");
                const iTitle = document.getElementById("input-title");
                const iSetting = document.getElementById("input-setting");
                const iTone = document.getElementById("input-tone");
                const iExtras = document.getElementById("input-extras");
                const iScale = document.getElementById("input-scale");
                const iIssuesCurrent = document.getElementById("input-issues-current");
                const iIssuesImpending = document.getElementById("input-issues-impending");
                const iFacesPlaces = document.getElementById("input-faces-places");
                const iRumors = document.getElementById("input-rumors");
                const iInciting = document.getElementById("input-inciting");
                const classNameInput = document.getElementsByClassName('input');
                const classNameInputArray = Array.from(classNameInput);
                const bSaveAll = document.getElementById("b-save-all");
                const bDelete = document.getElementById("b-delete");


                // NEW GAME DETAILS
                bNew.addEventListener("click", () => {
                    ddGames.selectedIndex = 0;
                    for (const element of classNameInputArray) {
                        element.value = "";
                    }
                });


                // SAVE GAME DETAILS
                bSaveAll.addEventListener("click", () => {
                    const newGame = {
                        title: iTitle.value.trim(),
                        setting: iSetting.value.trim(),
                        scale: iScale.value.trim(),
                        tone: iTone.value.trim(),
                        extras: iExtras.value.trim(),
                        issues_current: iIssuesCurrent.value.trim(),
                        issues_impending: iIssuesImpending.value.trim(),
                        faces_places: iFacesPlaces.value.trim(),
                        rumors: iRumors.value.trim(),
                        inciting: iInciting.value.trim()
                    };

                    if (!newGame.title) {
                        alert("Please enter a title before saving.");
                        return;
                    }

                    const existingIndex = storedGames.findIndex(game => game.title === newGame.title);

                    if (existingIndex !== -1) {
                        // Update existing game
                        storedGames[existingIndex] = newGame;
                    } else {
                        // Add as a new game
                        storedGames.push(newGame);
                    }

                    // Save back to localStorage
                    localStorage.setItem("games", JSON.stringify(storedGames));

                    // Refresh / Update dropdown
                    ddGames.innerHTML = "";
                    populateGameDropDown();

                    // Clear input fields
                    for (const element of classNameInputArray) {
                        element.value = "";
                    }
                });


                // DELETE GAME DETAILS
                bDelete.addEventListener("click", () => {
                    const selectedTitle = ddGames.value;

                    if (!selectedTitle) {
                        alert("Please select a game to delete.");
                        return;
                    }

                    // Confirm deletion
                    if (!confirm(`Are you sure you want to delete "${selectedTitle}"?`)) {
                        return;
                    }

                    // Find index of the selected game
                    const indexToDelete = storedGames.findIndex(game => game.title === selectedTitle);

                    if (indexToDelete !== -1) {
                        storedGames.splice(indexToDelete, 1); // Remove from array
                        localStorage.setItem("games", JSON.stringify(storedGames)); // Save changes

                        // Refresh dropdown
                        ddGames.innerHTML = "";
                        populateGameDropDown();
                        ddGames.selectedIndex = 0;

                        // Clear input fields
                        for (const element of classNameInputArray) {
                            element.value = "";
                        }

                        alert(`"${selectedTitle}" has been deleted.`);
                    } else {
                        alert("Game not found");
                    }
                });



                function populateGameDropDown() {
                    ddGames.innerHTML = "<option value=''>-- Select a saved game --</option>";
                    storedGames.forEach(game => {
                        const option = document.createElement("option");
                        option.value = game.title;
                        option.textContent = game.title;
                        ddGames.appendChild(option);
                    });
                }



                ddGames.addEventListener("change", function(event) {
                    const selectedValue = event.target.value;
                    const selectedGame = storedGames.find(game => game.title === selectedValue);

                    if (selectedGame) {
                        iTitle.value = selectedGame.title;
                        iSetting.value = selectedGame.setting;
                        iTone.value = selectedGame.tone;
                        iScale.value = selectedGame.scale;
                        iExtras.value = selectedGame.scale;
                        iIssuesCurrent.value = selectedGame.issues_current;
                        iIssuesImpending.value = selectedGame.issues_impending;
                        iFacesPlaces.value = selectedGame.faces_places;
                        iRumors.value = selectedGame.rumors;
                        iInciting.value = selectedGame.inciting;

                    } else {
                        iTitle.value = "";
                        iSetting.value = "";
                        iTone.value = "";
                        iScale.value = "";
                        iExtras.value = "";
                        iIssuesCurrent.value = "";
                        iIssuesImpending.value = "";
                        iFacesPlaces.value = "";
                        iInciting.value = "";
                        iRumors.value = "";
                    }
                });
                
                
                populateGameDropDown();

            });
        </script>
    </body>
</html>