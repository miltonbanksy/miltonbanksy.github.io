<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="style.css"> -->
  <title>Living Dead Doll Hangman</title>
  <style>
    .hide {
      visibility: hidden;
    }

    .show {
      visibility: visible;
    }

    .grid_container {
      display: flex;
      justify-content: space-between;
    }

    .grid_column {
      flex: 1;
      padding: 5px;
    }

    #underscores {
      font-size: 40px;
      color: purple;
    }

    .doll_template {
      width: 140px;
      height: 180px;
      /*border: 1px solid black;*/
    }
  </style>
</head>
<body>
  <h1>Living Dead Dolls ðŸ’€ Hangman ðŸ’€</h1>
  <button class="hide_during_game" id="btn_new_game">New Game</button>

  <div class="grid_container">
    <div class="grid_column">
      <p id="underscores"></p>
    </div>
    <div class="grid_column">
      <img class="doll_template hide" id="img_gallows">
    </div>
  </div>

  <h1 id="doll_name"></h1>

  <div class="grid_container">
    <div class="grid_column">
      <br>
      <img src="images/doll_shadow.png" class="doll_template hide" id="doll_img">
    </div>
    <div class="grid_column">
      <h2 id="doll_poem_title"></h2>
      <pre id="doll_poem"></pre>
      <h2 id="doll_epitaph_title"></h2>
      <pre id="doll_epitaph"></pre>
    </div>
  </div>
  
  <input class="inputs hide" id="input_try" type="text" placeholder="Enter 1 letter or full name">
  <button class="inputs hide" id="btn_try">Ok</button>
  <br><br>
  <button class="inputs hide" id="btn_TEST_reveal_answer">Give up? Reveal Answer</button>

  <!-- <script src="script.js"></script> -->
  <script>
  const gallowFrames = ["0_frame.png", "1_frame.png", "2_frame.png", "3_frame.png", "4_frame.png", "5_frame.png", "6_frame.png"];
  const sound_right = new Audio('sound-yay.mp3');
  const sound_wrong = new Audio('sound-wrong.mp3');
  const sound_fail = new Audio('sound-fail.mp3');

  let randomDoll = "";
  let gallowFrame = 0;
  let arrayOfUnderscores = [];
  let arrayOfCharacters = [];
  let wrongGuesses = 0;
  const maxWrongGuesses = 6;

  // pick random doll key
  function getRandomDoll() {
    const keys = Object.keys(dictDollNames);
    const randomIndex = Math.floor(Math.random() * keys.length);
    return keys[randomIndex];
  }

  // make underscores with * where spaces are
  function getArrayOfUnderscores(randomDoll) {
    arrayOfUnderscores = [];
    const dollName = dictDollNames[randomDoll].name.toLowerCase();

    for (let i = 0; i < dollName.length; i++) {
      if (dollName[i] === " ") {
        arrayOfUnderscores.push("*");
      } else {
        arrayOfUnderscores.push("_");
      }
    }
    return arrayOfUnderscores.join(" ");
  }

  // NEW GAME BUTTON PRESSED
  document.getElementById("btn_new_game").addEventListener('click', function () {
    wrongGuesses = 0;
    gallowFrame = 0;
    randomDoll = getRandomDoll();
    arrayOfUnderscores = [];
    arrayOfCharacters = [];

    arrayOfUnderscoresPrint = getArrayOfUnderscores(randomDoll);
    arrayOfCharacters = dictDollNames[randomDoll].name.toLowerCase().split("");

    // Hide elements
    let elements = document.querySelectorAll('.hide_during_game');
    elements.forEach(el => {
      el.classList.remove('show');
      el.classList.add('hide');
    });

    // Show images on start New Game
    let images = document.querySelectorAll('.doll_template');
    images.forEach(el => {
      el.classList.remove('hide');
      el.classList.add('show');
    });

    // Show input tools
    let inputs = document.querySelectorAll('.inputs');
    inputs.forEach(imps => {
      imps.classList.remove('hide');
      imps.classList.add('show');
    });

    document.getElementById("underscores").innerHTML = arrayOfUnderscoresPrint;
    document.getElementById("img_gallows").src = gallowFrames[gallowFrame];
    document.getElementById("doll_img").src = "images/doll_shadow.png";
    document.getElementById("doll_name").innerHTML = "";
    document.getElementById("doll_poem_title").innerHTML = "";
    document.getElementById("doll_poem").innerHTML = "";
    document.getElementById("doll_epitaph_title").innerHTML = "";
    document.getElementById("doll_epitaph").innerHTML = "";
  });

  // GUESS BUTTON PRESSED
  document.getElementById("btn_try").addEventListener('click', function () {
    let guess = document.getElementById("input_try").value.toLowerCase().trim();
    document.getElementById("input_try").value = "";

    if (guess === "") {
      alert("Enter a letter or full name!");
      return;
    }

    // FULL NAME GUESS
    if (guess.length > 1) {
      // strip spaces for comparison
      let cleanGuess = guess.replace(/\s+/g, "");
      let cleanAnswer = dictDollNames[randomDoll].name.toLowerCase().replace(/\s+/g, "");

      if (cleanGuess === cleanAnswer) {
        alert("ðŸŽ‰ You win! The doll is " + dictDollNames[randomDoll].name);
        revealDoll();
        return;
      } else {
        gallowFrame++;
        wrongGuesses++;
        document.getElementById("img_gallows").src = gallowFrames[gallowFrame];
        alert(`Wrong name! You have ${maxWrongGuesses - wrongGuesses} guesses left.`);
      }
    }

    // SINGLE LETTER GUESS
    else {
      const indices = [];
      arrayOfCharacters.forEach((char, index) => {
        if (char === guess) {
          indices.push(index);
          sound_right.play();
        }
      });

      if (indices.length > 0) {
        indices.forEach(i => {
          arrayOfUnderscores[i] = guess;
        });
      } else {
        gallowFrame++;
        wrongGuesses++;
        document.getElementById("img_gallows").src = gallowFrames[gallowFrame];
        sound_wrong.play();
        alert(`Letter not found! You have ${maxWrongGuesses - wrongGuesses} guesses left.`);
      }

      let arrayOfUnderscoresPrint = arrayOfUnderscores.join(" ");
      document.getElementById("underscores").innerHTML = arrayOfUnderscoresPrint;
    }

    // Win Check
    if (!arrayOfUnderscores.includes("_")) {
      alert("ðŸŽ‰ You win! The doll is " + dictDollNames[randomDoll].name);
      revealDoll();
    }

    // Loss Check
    if (wrongGuesses >= maxWrongGuesses) {
      sound_fail.play();
      alert("ðŸ’€ Game Over! The doll is " + dictDollNames[randomDoll].name);
      revealDoll();
    }
  });

  function revealDoll() {
    arrayOfUnderscores = arrayOfCharacters.slice();
    document.getElementById("underscores").innerHTML = arrayOfUnderscores.join(" ");
    document.getElementById("doll_img").src = dictDollNames[randomDoll].img;
    document.getElementById("doll_name").innerHTML = dictDollNames[randomDoll].name;
    document.getElementById("doll_poem_title").innerHTML = `${dictDollNames[randomDoll].name}'s Poem`;
    document.getElementById("doll_poem").innerHTML = dictDollNames[randomDoll].poem;
    document.getElementById("doll_epitaph_title").innerHTML = `${dictDollNames[randomDoll].name}'s Epitaph`;
    document.getElementById("doll_epitaph").innerHTML = dictDollNames[randomDoll].epitaph;

    // Show New Game button
    let elementsToShow = document.querySelectorAll('.hide_during_game');
    elementsToShow.forEach(el => {
      el.classList.remove('hide');
      el.classList.add('show');
    });

    // Hide input tools
    let elementsToHide = document.querySelectorAll('.inputs');
    elementsToHide.forEach(el => {
      el.classList.remove('show');
      el.classList.add('hide');
    });
  }

  document.getElementById("btn_TEST_reveal_answer").addEventListener('click', function () {
    sound_fail.play();
    revealDoll();
  });
</script>

  <script src="hangman_ldd_characters.js"></script>
</body>
</html>
